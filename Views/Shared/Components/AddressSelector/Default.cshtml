<div class="css_select_div">
    <!-- Tỉnh/Thành -->
    <select class="css_select" id="province" name="ProvinceCode">
        <option value="">Chọn Tỉnh Thành</option>
        @foreach (var province in (IEnumerable<dynamic>)ViewBag.Provinces)
        {
            var isSelected = ViewBag.SelectedProvinceCode?.ToString() == province.Code ? "selected" : "";
            <option value="@province.Code" isSelected>
                @province.FullName
            </option>
        }
    </select>


    <!-- Quận/Huyện -->
    <select class="css_select" id="district" name="DistrictCode">
        <option value="">Chọn Quận Huyện</option>
        @if (ViewBag.Districts != null)
        {
            foreach (var district in (IEnumerable<dynamic>)ViewBag.Districts)
            {
                @* var isSelected = ViewBag.SelectedDistrictCode?.ToString() == district.Code ? "selected" : ""; *@
                <option value="@district.Code">
                    @district.FullName
                </option>
            }
        }
    </select>


    <!-- Xã/Phường -->
    <select class="css_select" id="ward" name="WardCode">
        <option value="">Chọn Phường Xã</option>
        @if (ViewBag.Wards != null)
        {
            foreach (var ward in (IEnumerable<dynamic>)ViewBag.Wards)
            {
                @* var isSelected = ViewBag.SelectedWardCode?.ToString() == ward.Code ? "selected" : ""; *@
                <option value="@ward.Code">
                    @ward.FullName
                </option>
            }
        }
    </select>

</div>

<script>
    $(document).ready(function () {
        // Gọi khi khởi tạo nếu đã có giá trị được chọn
        var selectedProvinceCode = '@ViewBag.SelectedProvinceCode';
        var selectedDistrictCode = '@ViewBag.SelectedDistrictCode';
        var selectedWardCode = '@ViewBag.SelectedWardCode';

        if (selectedProvinceCode) {
            $('#province').val(selectedProvinceCode); // Set giá trị đã chọn
            loadDistricts(selectedProvinceCode, selectedDistrictCode);

            if (selectedDistrictCode) {
                loadWards(selectedDistrictCode, selectedWardCode);
            }
        }

        function loadDistricts(provinceCode, selectedDistrictCode) {
            if (provinceCode) {
                $.getJSON(`/api/provinces/${provinceCode}/districts`, function (data) {
                    $('#district').html('<option value="">Chọn Quận Huyện</option>');
                    $.each(data, function (index, district) {
                        var selected = district.code === selectedDistrictCode ? "selected" : "";
                        $('#district').append('<option value="' + district.code + '" ' + selected + '>' + district.fullName + '</option>');
                    });
                });
            }
        }

        function loadWards(districtCode, selectedWardCode) {
            if (districtCode) {
                $.getJSON(`/api/provinces/districts/${districtCode}/wards`, function (data) {
                    $('#ward').html('<option value="">Chọn Phường Xã</option>');
                    $.each(data, function (index, ward) {
                        var selected = ward.code === selectedWardCode ? "selected" : "";
                        $('#ward').append('<option value="' + ward.code + '" ' + selected + '>' + ward.fullName + '</option>');
                    });
                });
            }
        }
    });



</script>
